var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function l(e){e.forEach(t)}function o(e){return"function"==typeof e}function r(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function c(e,t){e.appendChild(t)}function u(e,t,n){e.insertBefore(t,n||null)}function a(e){e.parentNode.removeChild(e)}function i(e){return document.createElement(e)}function s(e){return document.createTextNode(e)}function f(){return s(" ")}function d(e,t,n,l){return e.addEventListener(t,n,l),()=>e.removeEventListener(t,n,l)}function h(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function p(e,t){e.value=null==t?"":t}function v(e,t,n){e.classList[n?"add":"remove"](t)}let b;function g(e){b=e}const m=[],$=[],x=[],_=[],y=Promise.resolve();let k=!1;function w(e){x.push(e)}let E=!1;const C=new Set;function A(){if(!E){E=!0;do{for(let e=0;e<m.length;e+=1){const t=m[e];g(t),L(t.$$)}for(g(null),m.length=0;$.length;)$.pop()();for(let e=0;e<x.length;e+=1){const t=x[e];C.has(t)||(C.add(t),t())}x.length=0}while(m.length);for(;_.length;)_.pop()();k=!1,E=!1,C.clear()}}function L(e){if(null!==e.fragment){e.update(),l(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(w)}}const O=new Set;function T(e,t){-1===e.$$.dirty[0]&&(m.push(e),k||(k=!0,y.then(A)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function j(r,c,u,i,s,f,d=[-1]){const h=b;g(r);const p=c.props||{},v=r.$$={fragment:null,ctx:null,props:f,update:e,not_equal:s,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:[]),callbacks:n(),dirty:d,skip_bound:!1};let m=!1;if(v.ctx=u?u(r,p,((e,t,...n)=>{const l=n.length?n[0]:t;return v.ctx&&s(v.ctx[e],v.ctx[e]=l)&&(!v.skip_bound&&v.bound[e]&&v.bound[e](l),m&&T(r,e)),t})):[],v.update(),m=!0,l(v.before_update),v.fragment=!!i&&i(v.ctx),c.target){if(c.hydrate){const e=function(e){return Array.from(e.childNodes)}(c.target);v.fragment&&v.fragment.l(e),e.forEach(a)}else v.fragment&&v.fragment.c();c.intro&&(($=r.$$.fragment)&&$.i&&(O.delete($),$.i(x))),function(e,n,r){const{fragment:c,on_mount:u,on_destroy:a,after_update:i}=e.$$;c&&c.m(n,r),w((()=>{const n=u.map(t).filter(o);a?a.push(...n):l(n),e.$$.on_mount=[]})),i.forEach(w)}(r,c.target,c.anchor),A()}var $,x;g(h)}function B(e,t,n){const l=e.slice();return l[14]=t[n],l}function D(e){let t;return{c(){t=i("h2"),t.textContent="まずはあなたの枕と接続しよう！"},m(e,n){u(e,t,n)},d(e){e&&a(t)}}}function M(e){let t,n,o,r,s,v,b,g,m,$,x=e[3],_=[];for(let t=0;t<x.length;t+=1)_[t]=N(B(e,x,t));return{c(){t=i("h2"),t.textContent="アラームを設定しよう！",n=f(),o=i("form"),r=i("input"),s=f(),v=i("div");for(let e=0;e<_.length;e+=1)_[e].c();b=f(),g=i("div"),g.innerHTML='<button class="submit-button svelte-1fbx9ar" type="submit">設定する</button>',h(r,"type","time"),h(v,"class","weekday-fields svelte-1fbx9ar"),h(g,"class","button-wrapper svelte-1fbx9ar"),h(o,"class","svelte-1fbx9ar")},m(l,a){u(l,t,a),u(l,n,a),u(l,o,a),c(o,r),p(r,e[0]),c(o,s),c(o,v);for(let e=0;e<_.length;e+=1)_[e].m(v,null);var i;c(o,b),c(o,g),m||($=[d(r,"input",e[6]),d(o,"submit",(i=e[5],function(e){return e.preventDefault(),i.call(this,e)}))],m=!0)},p(e,t){if(1&t&&p(r,e[0]),10&t){let n;for(x=e[3],n=0;n<x.length;n+=1){const l=B(e,x,n);_[n]?_[n].p(l,t):(_[n]=N(l),_[n].c(),_[n].m(v,null))}for(;n<_.length;n+=1)_[n].d(1);_.length=x.length}},d(e){e&&a(t),e&&a(n),e&&a(o),function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(_,e),m=!1,l($)}}}function N(e){let t,n,l,o,r,p,b,g,m=e[14].label+"";return{c(){t=i("label"),n=i("input"),l=f(),o=i("div"),r=s(m),p=f(),h(n,"type","checkbox"),n.__value=e[14].value,n.value=n.__value,n.hidden=!0,e[8][0].push(n),h(o,"class","weekday svelte-1fbx9ar"),v(o,"selected",e[1].includes(e[14].value))},m(a,i){u(a,t,i),c(t,n),n.checked=~e[1].indexOf(n.__value),c(t,l),c(t,o),c(o,r),c(t,p),b||(g=d(n,"change",e[7]),b=!0)},p(e,t){2&t&&(n.checked=~e[1].indexOf(n.__value)),10&t&&v(o,"selected",e[1].includes(e[14].value))},d(l){l&&a(t),e[8][0].splice(e[8][0].indexOf(n),1),b=!1,g()}}}function P(t){let n,l,o,r,p,v,b,g,m,$,x=t[2]?"別の枕と接続する":"枕と接続する",_=!t[2]&&D(),y=t[2]&&M(t);return{c(){n=i("main"),l=i("h1"),l.textContent="MakuraFit Adventure",o=f(),_&&_.c(),r=f(),p=i("div"),v=i("button"),b=s(x),g=f(),y&&y.c(),h(l,"class","svelte-1fbx9ar"),h(v,"class","connect-button svelte-1fbx9ar"),h(v,"type","button"),h(p,"class","button-wrapper svelte-1fbx9ar"),h(n,"class","svelte-1fbx9ar")},m(e,a){u(e,n,a),c(n,l),c(n,o),_&&_.m(n,null),c(n,r),c(n,p),c(p,v),c(v,b),c(n,g),y&&y.m(n,null),m||($=d(v,"click",t[4]),m=!0)},p(e,[t]){e[2]?_&&(_.d(1),_=null):_||(_=D(),_.c(),_.m(n,r)),4&t&&x!==(x=e[2]?"別の枕と接続する":"枕と接続する")&&function(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}(b,x),e[2]?y?y.p(e,t):(y=M(e),y.c(),y.m(n,null)):y&&(y.d(1),y=null)},i:e,o:e,d(e){e&&a(n),_&&_.d(),y&&y.d(),m=!1,$()}}}const S="6e400001-b5a3-f393-e0a9-e50e24dcca9e";function q(e,t,n){let l=null,o=[];const r=[{value:1,label:"日"},{value:2,label:"月"},{value:3,label:"火"},{value:4,label:"水"},{value:5,label:"木"},{value:6,label:"金"},{value:7,label:"土"}];let c=!0,u=null,a=null,i=null;const s=[[]];return[l,o,c,r,()=>{if(navigator.bluetooth&&navigator.bluetooth.requestDevice)return c?(u.disconnect(),void n(2,c=!1)):void navigator.bluetooth.requestDevice({filters:[{services:[S]},{namePrefix:"BBC micro:bit"}]}).then((e=>(u=e.gatt,u.connect()))).then((e=>e.getPrimaryService(S))).then((e=>Promise.all([e.getCharacteristic("6e400002-b5a3-f393-e0a9-e50e24dcca9e"),e.getCharacteristic("6e400003-b5a3-f393-e0a9-e50e24dcca9e")]))).then((e=>{a=e[0],a.startNotifications(),a.addEventListener("characteristicvaluechanged",(e=>(e=>console.log(e))((new TextDecoder).decode(e.target.value)))),i=e[1],n(2,c=!0)})).catch((function(e){alert(e)}));alert("WebBluetooth に未対応のブラウザです。")},()=>{console.log(l,o);let e="";if(l||(e+="時刻を設定してください！\n"),o.length||(e+="曜日を設定してください！\n"),e.length)return void alert(e);const t=r.map((e=>o.includes(e.value)?1:0));(e=>{console.log("send:",e),i?.writeValue((new TextEncoder).encode(e+"\n"))})(`ALERM:${l.replace(":",",")},${t.join("")}`),alert("アラームを設定しました！")},function(){l=this.value,n(0,l)},function(){o=function(e,t,n){const l=new Set;for(let t=0;t<e.length;t+=1)e[t].checked&&l.add(e[t].__value);return n||l.delete(t),Array.from(l)}(s[0],this.__value,this.checked),n(1,o)},s]}return new class extends class{$destroy(){!function(e,t){const n=e.$$;null!==n.fragment&&(l(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}{constructor(e){super(),j(this,e,q,P,r,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
