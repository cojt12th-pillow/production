var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function l(e){e.forEach(t)}function o(e){return"function"==typeof e}function c(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function r(e,t){e.appendChild(t)}function u(e,t,n){e.insertBefore(t,n||null)}function a(e){e.parentNode.removeChild(e)}function i(e){return document.createElement(e)}function s(e){return document.createTextNode(e)}function f(){return s(" ")}function d(e,t,n,l){return e.addEventListener(t,n,l),()=>e.removeEventListener(t,n,l)}function h(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function p(e,t){e.value=null==t?"":t}function v(e,t,n){e.classList[n?"add":"remove"](t)}let g;function m(e){g=e}const b=[],$=[],_=[],y=[],k=Promise.resolve();let x=!1;function w(e){_.push(e)}let j=!1;const E=new Set;function A(){if(!j){j=!0;do{for(let e=0;e<b.length;e+=1){const t=b[e];m(t),C(t.$$)}for(m(null),b.length=0;$.length;)$.pop()();for(let e=0;e<_.length;e+=1){const t=_[e];E.has(t)||(E.add(t),t())}_.length=0}while(b.length);for(;y.length;)y.pop()();x=!1,j=!1,E.clear()}}function C(e){if(null!==e.fragment){e.update(),l(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(w)}}const S=new Set;function T(e,t){-1===e.$$.dirty[0]&&(b.push(e),x||(x=!0,k.then(A)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function O(c,r,u,i,s,f,d=[-1]){const h=g;m(c);const p=r.props||{},v=c.$$={fragment:null,ctx:null,props:f,update:e,not_equal:s,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:[]),callbacks:n(),dirty:d,skip_bound:!1};let b=!1;if(v.ctx=u?u(c,p,((e,t,...n)=>{const l=n.length?n[0]:t;return v.ctx&&s(v.ctx[e],v.ctx[e]=l)&&(!v.skip_bound&&v.bound[e]&&v.bound[e](l),b&&T(c,e)),t})):[],v.update(),b=!0,l(v.before_update),v.fragment=!!i&&i(v.ctx),r.target){if(r.hydrate){const e=function(e){return Array.from(e.childNodes)}(r.target);v.fragment&&v.fragment.l(e),e.forEach(a)}else v.fragment&&v.fragment.c();r.intro&&(($=c.$$.fragment)&&$.i&&(S.delete($),$.i(_))),function(e,n,c){const{fragment:r,on_mount:u,on_destroy:a,after_update:i}=e.$$;r&&r.m(n,c),w((()=>{const n=u.map(t).filter(o);a?a.push(...n):l(n),e.$$.on_mount=[]})),i.forEach(w)}(c,r.target,r.anchor),A()}var $,_;m(h)}function D(e,t,n){const l=e.slice();return l[14]=t[n],l}function L(e){let t;return{c(){t=i("h2"),t.textContent="まずはあなたの枕と接続しよう！"},m(e,n){u(e,t,n)},d(e){e&&a(t)}}}function B(e){let t,n,o,c,s,v,g,m,b,$,_=e[3],y=[];for(let t=0;t<_.length;t+=1)y[t]=M(D(e,_,t));return{c(){t=i("h2"),t.textContent="アラームを設定しよう！",n=f(),o=i("form"),c=i("input"),s=f(),v=i("div");for(let e=0;e<y.length;e+=1)y[e].c();g=f(),m=i("div"),m.innerHTML='<button class="submit-button svelte-25jp2k" type="submit">設定する</button>',h(c,"type","time"),h(v,"class","weekday-fields svelte-25jp2k"),h(m,"class","button-wrapper svelte-25jp2k"),h(o,"class","svelte-25jp2k")},m(l,a){u(l,t,a),u(l,n,a),u(l,o,a),r(o,c),p(c,e[0]),r(o,s),r(o,v);for(let e=0;e<y.length;e+=1)y[e].m(v,null);var i;r(o,g),r(o,m),b||($=[d(c,"input",e[6]),d(o,"submit",(i=e[5],function(e){return e.preventDefault(),i.call(this,e)}))],b=!0)},p(e,t){if(1&t&&p(c,e[0]),10&t){let n;for(_=e[3],n=0;n<_.length;n+=1){const l=D(e,_,n);y[n]?y[n].p(l,t):(y[n]=M(l),y[n].c(),y[n].m(v,null))}for(;n<y.length;n+=1)y[n].d(1);y.length=_.length}},d(e){e&&a(t),e&&a(n),e&&a(o),function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(y,e),b=!1,l($)}}}function M(e){let t,n,l,o,c,p,g,m,b=e[14].label+"";return{c(){t=i("label"),n=i("input"),l=f(),o=i("div"),c=s(b),p=f(),h(n,"type","checkbox"),n.__value=e[14].value,n.value=n.__value,n.hidden=!0,e[8][0].push(n),h(o,"class","weekday svelte-25jp2k"),v(o,"selected",e[1].includes(e[14].value))},m(a,i){u(a,t,i),r(t,n),n.checked=~e[1].indexOf(n.__value),r(t,l),r(t,o),r(o,c),r(t,p),g||(m=d(n,"change",e[7]),g=!0)},p(e,t){2&t&&(n.checked=~e[1].indexOf(n.__value)),10&t&&v(o,"selected",e[1].includes(e[14].value))},d(l){l&&a(t),e[8][0].splice(e[8][0].indexOf(n),1),g=!1,m()}}}function N(t){let n,l,o,c,p,v,g,m,b,$,_=t[2]?"別の枕と接続する":"枕と接続する",y=!t[2]&&L(),k=t[2]&&B(t);return{c(){n=i("main"),l=i("h1"),l.textContent="MakuraFit Adventure",o=f(),y&&y.c(),c=f(),p=i("div"),v=i("button"),g=s(_),m=f(),k&&k.c(),h(l,"class","svelte-25jp2k"),h(v,"class","connect-button svelte-25jp2k"),h(v,"type","button"),h(p,"class","button-wrapper svelte-25jp2k"),h(n,"class","svelte-25jp2k")},m(e,a){u(e,n,a),r(n,l),r(n,o),y&&y.m(n,null),r(n,c),r(n,p),r(p,v),r(v,g),r(n,m),k&&k.m(n,null),b||($=d(v,"click",t[4]),b=!0)},p(e,[t]){e[2]?y&&(y.d(1),y=null):y||(y=L(),y.c(),y.m(n,c)),4&t&&_!==(_=e[2]?"別の枕と接続する":"枕と接続する")&&function(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}(g,_),e[2]?k?k.p(e,t):(k=B(e),k.c(),k.m(n,null)):k&&(k.d(1),k=null)},i:e,o:e,d(e){e&&a(n),y&&y.d(),k&&k.d(),b=!1,$()}}}const P="6e400001-b5a3-f393-e0a9-e50e24dcca9e";function q(e,t,n){let l=null,o=[];let c=!0,r=null,u=null,a=null;const i=e=>a?.writeValue((new TextEncoder).encode(e+"\n")),s=[[]];return[l,o,c,[{value:1,label:"月"},{value:2,label:"火"},{value:3,label:"水"},{value:4,label:"木"},{value:5,label:"金"},{value:6,label:"土"},{value:7,label:"日"}],()=>{if(navigator.bluetooth&&navigator.bluetooth.requestDevice)return c?(r.disconnect(),void n(2,c=!1)):void navigator.bluetooth.requestDevice({filters:[{services:[P]},{namePrefix:"BBC micro:bit"}]}).then((e=>(r=e.gatt,r.connect()))).then((e=>e.getPrimaryService(P))).then((e=>Promise.all([e.getCharacteristic("6e400002-b5a3-f393-e0a9-e50e24dcca9e"),e.getCharacteristic("6e400003-b5a3-f393-e0a9-e50e24dcca9e")]))).then((e=>{u=e[0],u.startNotifications(),u.addEventListener("characteristicvaluechanged",(e=>(e=>console.log(e))((new TextDecoder).decode(e.target.value)))),a=e[1],n(2,c=!0),i(`SET_DATE:${(new Date).toISOString()}`)})).catch((function(e){alert(e)}));alert("WebBluetooth に未対応のブラウザです。")},()=>{console.log(l,o);let e="";l||(e+="時刻を設定してください！\n"),o.length||(e+="曜日を設定してください！\n"),e.length?alert(e):(i(`SET_ALERM:${l.replace(":",",")},${o.join(",")}`),alert("アラームを設定しました！"))},function(){l=this.value,n(0,l)},function(){o=function(e,t,n){const l=new Set;for(let t=0;t<e.length;t+=1)e[t].checked&&l.add(e[t].__value);return n||l.delete(t),Array.from(l)}(s[0],this.__value,this.checked),n(1,o)},s]}return new class extends class{$destroy(){!function(e,t){const n=e.$$;null!==n.fragment&&(l(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}{constructor(e){super(),O(this,e,q,N,c,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
